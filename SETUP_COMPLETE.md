# ‚úÖ ƒê√É HO√ÄN TH√ÄNH: DND Live Quiz Permalinks Settings

## üéØ T√≠nh nƒÉng m·ªõi

Gi·ªù ƒë√¢y b·∫°n c√≥ th·ªÉ t√πy ch·ªânh URL base cho Host Room gi·ªëng nh∆∞ c√°c plugin chuy√™n nghi·ªáp kh√°c (WooCommerce, LearnDash...)

## üöÄ C√°ch s·ª≠ d·ª•ng

### B∆∞·ªõc 1: Setup (ch·ªçn 1 trong 3 c√°ch)

**C√°ch 1: Qua trang test (ƒê·ªÄ XU·∫§T)**
```
Truy c·∫≠p: https://yourdomain.com/wp-content/plugins/dnd-live-quiz/test-permalink.php
```
‚Üí Trang n√†y s·∫Ω:
- ‚úÖ Ki·ªÉm tra option ƒë√£ t·ªìn t·∫°i ch∆∞a
- ‚úÖ T·∫°o option n·∫øu ch∆∞a c√≥
- ‚úÖ Flush rewrite rules
- ‚úÖ Hi·ªÉn th·ªã configuration hi·ªán t·∫°i
- ‚úÖ Test rewrite rules c√≥ ho·∫°t ƒë·ªông kh√¥ng

**C√°ch 2: Qua WordPress Admin**
```
1. V√†o: Settings > Permalinks
2. K√©o xu·ªëng ph·∫ßn "DND Live Quiz Permalinks"
3. Nh·∫≠p base slug (m·∫∑c ƒë·ªãnh: "play")
4. Click "Save Changes"
```

**C√°ch 3: Deactivate & Reactivate plugin**
```
1. Plugins > Installed Plugins
2. Deactivate "DND Live Quiz"
3. Activate l·∫°i
4. Option s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông
```

### B∆∞·ªõc 2: Ki·ªÉm tra Settings

V√†o **Settings > Permalinks**, b·∫°n s·∫Ω th·∫•y:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ DND Live Quiz Permalinks                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ C√†i ƒë·∫∑t c·∫•u tr√∫c URL cho Live Quiz.     ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ Host Room Base                          ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îÇ
‚îÇ ‚îÇ play         ‚îÇ                        ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ URL ƒë·ªÉ host truy c·∫≠p ph√≤ng.             ‚îÇ
‚îÇ M·∫∑c ƒë·ªãnh: https://domain.com/play/123   ‚îÇ
‚îÇ V√≠ d·ª•: n·∫øu b·∫°n nh·∫≠p "room",             ‚îÇ
‚îÇ URL s·∫Ω l√† /room/123                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### B∆∞·ªõc 3: Test ho·∫°t ƒë·ªông

1. **T·∫°o ph√≤ng m·ªõi:**
   - V√†o trang c√≥ shortcode `[live_quiz_create_room]`
   - Ch·ªçn quiz v√† t·∫°o ph√≤ng
   - S·∫Ω t·ª± ƒë·ªông redirect ƒë·∫øn `/play/{session_id}`

2. **Ki·ªÉm tra URL:**
   - V·ªõi base `play`: `https://yourdomain.com/play/123`
   - V·ªõi base `room`: `https://yourdomain.com/room/123`
   - V·ªõi base `host`: `https://yourdomain.com/host/123`

## üé® T√πy ch·ªânh URL Base

B·∫°n c√≥ th·ªÉ ƒë·ªïi t·ª´ `play` sang b·∫•t k·ª≥ slug n√†o:

| Base | URL Result | Use Case |
|------|-----------|----------|
| `play` | `/play/123` | M·∫∑c ƒë·ªãnh, ng·∫Øn g·ªçn |
| `room` | `/room/123` | D·ªÖ hi·ªÉu h∆°n |
| `host` | `/host/123` | Ph√¢n bi·ªát r√µ v·ªõi player |
| `quiz-host` | `/quiz-host/123` | SEO friendly |
| `live` | `/live/123` | Ng·∫Øn g·ªçn |
| `session` | `/session/123` | K·ªπ thu·∫≠t h∆°n |

**L∆∞u √Ω:** Sau khi thay ƒë·ªïi, nh·∫•n "Save Changes" ƒë·ªÉ WordPress t·ª± ƒë·ªông flush rewrite rules.

## üìÅ File ƒë√£ thay ƒë·ªïi

### Core Files

#### `includes/class-post-types.php`
```php
‚úÖ add_permalink_settings()        - ƒêƒÉng k√Ω settings
‚úÖ permalink_settings_section()     - Hi·ªÉn th·ªã section header
‚úÖ play_base_field()                - Render input field
‚úÖ sanitize_play_base()             - Validate & sanitize
‚úÖ get_play_base()                  - L·∫•y gi√° tr·ªã base
‚úÖ flush_rewrite_rules_on_change()  - Auto flush khi thay ƒë·ªïi
‚úÖ add_rewrite_rules()              - C·∫≠p nh·∫≠t s·ª≠ d·ª•ng base ƒë·ªông
```

#### `includes/class-rest-api.php`
```php
‚úÖ create_session() - S·ª≠ d·ª•ng base ƒë·ªông cho host_url
```

#### `live-quiz.php`
```php
‚úÖ register_activation_hook() - T·∫°o option 'live_quiz_play_base'
```

### Utility Files
- ‚úÖ `test-permalink.php` - Trang test v√† setup
- ‚úÖ `setup-permalinks.php` - Script CLI setup
- ‚úÖ `PERMALINK_SETUP.md` - H∆∞·ªõng d·∫´n chi ti·∫øt

## üîç Troubleshooting

### V·∫´n b·ªã 404 sau khi setup

**Gi·∫£i ph√°p 1: Flush th·ªß c√¥ng**
```
V√†o: Settings > Permalinks > Save Changes
```

**Gi·∫£i ph√°p 2: Ch·∫°y test page**
```
https://yourdomain.com/wp-content/plugins/dnd-live-quiz/test-permalink.php
```

**Gi·∫£i ph√°p 3: Ki·ªÉm tra .htaccess**
```bash
# File ph·∫£i c√≥ quy·ªÅn ghi
chmod 644 /home/wordpress-da/html/.htaccess

# N·ªôi dung c∆° b·∫£n:
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
```

### Kh√¥ng th·∫•y section trong Permalinks page

**Check 1: Plugin ƒë√£ activate?**
```
Plugins > Installed Plugins > DND Live Quiz (Active)
```

**Check 2: Clear cache**
```
# N·∫øu d√πng cache plugin
- Clear WordPress cache
- Clear browser cache
- Refresh trang Settings > Permalinks
```

**Check 3: Check logs**
```php
// Add v√†o wp-config.php ƒë·ªÉ debug
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
```

### URL kh√¥ng ho·∫°t ƒë·ªông v·ªõi base m·ªõi

**Nguy√™n nh√¢n:** Rewrite rules ch∆∞a ƒë∆∞·ª£c flush

**Gi·∫£i ph√°p:**
```
1. V√†o Settings > Permalinks
2. Click "Save Changes" (kh√¥ng c·∫ßn ƒë·ªïi g√¨)
3. Test l·∫°i URL
```

## üéØ Workflow ho√†n ch·ªânh

```
1. Setup (1 l·∫ßn duy nh·∫•t)
   ‚Üì
2. V√†o Settings > Permalinks > ƒê·ªïi base (optional)
   ‚Üì
3. T·∫°o quiz room t·ª´ frontend
   ‚Üì
4. Auto redirect ƒë·∫øn /{base}/{session_id}
   ‚Üì
5. Host qu·∫£n l√Ω ph√≤ng
   ‚Üì
6. Players join b·∫±ng PIN code
```

## ‚ú® ∆Øu ƒëi·ªÉm

‚úÖ **Chu·∫©n WordPress:** Gi·ªëng WooCommerce, LearnDash, WPML...
‚úÖ **User-friendly:** Admin c√≥ th·ªÉ t√πy ch·ªânh d·ªÖ d√†ng
‚úÖ **Auto flush:** T·ª± ƒë·ªông flush rewrite rules
‚úÖ **Validation:** T·ª± ƒë·ªông sanitize input
‚úÖ **SEO friendly:** URL c√≥ th·ªÉ t√πy ch·ªânh
‚úÖ **Documented:** C√≥ m√¥ t·∫£, v√≠ d·ª• r√µ r√†ng

## üì∏ Screenshot

V·ªã tr√≠ trong WordPress Admin:

```
Dashboard
‚îú‚îÄ‚îÄ Settings
    ‚îî‚îÄ‚îÄ Permalinks
        ‚îú‚îÄ‚îÄ Common Settings
        ‚îú‚îÄ‚îÄ Optional
        ‚îÇ   ‚îú‚îÄ‚îÄ Category base
        ‚îÇ   ‚îî‚îÄ‚îÄ Tag base
        ‚îú‚îÄ‚îÄ Product permalinks (WooCommerce)
        ‚îú‚îÄ‚îÄ LearnDash Permalinks
        ‚îî‚îÄ‚îÄ DND Live Quiz Permalinks ‚ú® NEW
            ‚îî‚îÄ‚îÄ Host Room Base: [play]
```

## üéâ Ho√†n th√†nh!

B√¢y gi·ªù b·∫°n c√≥ th·ªÉ:
- ‚úÖ T√πy ch·ªânh URL base qua Settings > Permalinks
- ‚úÖ T·∫°o ph√≤ng v√† auto redirect ƒë·∫øn URL ƒë·∫πp
- ‚úÖ Players join b·∫±ng PIN 6 s·ªë
- ‚úÖ Host qu·∫£n l√Ω ph√≤ng v·ªõi giao di·ªán chuy√™n nghi·ªáp

---

**Test ngay:** Truy c·∫≠p `https://yourdomain.com/wp-content/plugins/dnd-live-quiz/test-permalink.php`
